(this.webpackJsonpgameboys=this.webpackJsonpgameboys||[]).push([[0],{13:function(e,t,n){e.exports=n(27)},18:function(e,t,n){},25:function(e,t,n){},26:function(e,t,n){},27:function(e,t,n){"use strict";n.r(t);var o=n(0),a=n.n(o),r=n(11),i=n.n(r),s=(n(18),n(7)),u=n(2),c=n(3),l=n(5),h=n(4),d=n(1),T=function(){function e(t){var n=this;Object(u.a)(this,e),this.onAnimationFrame=function(e){n.requestAnimationFrame();var t=e%n.interval,o=e-t;if(n.lastFrameTime){var a=Math.round((o-n.lastFrameTime)/n.interval);if(0!==a){n.generateFrame(),n.onWriteFrame();for(var r=n.interval-t,i=1;i<a;i++)setTimeout((function(){n.generateFrame()}),i*r/a)}}else n.lastFrameTime=o},this.onGenerateFrame=t.onGenerateFrame,this.onWriteFrame=t.onWriteFrame,this.onAnimationFrame=this.onAnimationFrame.bind(this),this.running=!0,this.interval=1e3/60.098,this.lastFrameTime=!1}return Object(c.a)(e,[{key:"start",value:function(){this.running=!0,this.requestAnimationFrame()}},{key:"stop",value:function(){this.running=!1,this._requestID&&window.cancelAnimationFrame(this._requestID),this.lastFrameTime=!1}},{key:"requestAnimationFrame",value:function(){this._requestID=window.requestAnimationFrame(this.onAnimationFrame)}},{key:"generateFrame",value:function(){this.onGenerateFrame(),this.lastFrameTime+=this.interval}}]),e}(),f=(d.Controller.BUTTON_A,d.Controller.BUTTON_B,d.Controller.BUTTON_B,d.Controller.BUTTON_SELECT,d.Controller.BUTTON_START,d.Controller.BUTTON_UP,d.Controller.BUTTON_DOWN,d.Controller.BUTTON_LEFT,d.Controller.BUTTON_RIGHT,d.Controller.BUTTON_A,d.Controller.BUTTON_B,d.Controller.BUTTON_SELECT,d.Controller.BUTTON_START,d.Controller.BUTTON_UP,d.Controller.BUTTON_DOWN,d.Controller.BUTTON_LEFT,d.Controller.BUTTON_RIGHT,n(25),function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(u.a)(this,n);for(var o=arguments.length,a=new Array(o),r=0;r<o;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).setBuffer=function(t){for(var n=0,o=0;o<240;++o)for(var a=0;a<256;++a)n=256*o+a,e.buf32[n]=4278190080|t[n]},e.writeBuffer=function(){e.imageData.data.set(e.buf8),e.context.putImageData(e.imageData,0,0)},e.fitInParent=function(){var t=e.canvas.parentNode,n=t.clientWidth,o=t.clientHeight;256/240<n/o?(e.canvas.style.width="".concat(Math.round(o*(256/240)),"px"),e.canvas.style.height="".concat(o,"px")):(e.canvas.style.width="".concat(n,"px"),e.canvas.style.height="".concat(Math.round(n/(256/240)),"px"))},e.handleMouseDown=function(t){if(e.props.onMouseDown){var n=256/parseFloat(e.canvas.style.width),o=e.canvas.getBoundingClientRect(),a=Math.round((t.clientX-o.left)*n),r=Math.round((t.clientY-o.top)*n);e.props.onMouseDown(a,r)}},e}return Object(c.a)(n,[{key:"render",value:function(){var e=this;return a.a.createElement("canvas",{className:"Screen",width:256,height:240,onMouseDown:this.handleMouseDown,onMouseUp:this.props.onMouseUp,ref:function(t){e.canvas=t}})}},{key:"componentDidMount",value:function(){this.initCanvas()}},{key:"componentDidUpdate",value:function(){this.initCanvas()}},{key:"initCanvas",value:function(){this.context=this.canvas.getContext("2d"),this.imageData=this.context.getImageData(0,0,256,240),this.context.fillStyle="black",this.context.fillRect(0,0,256,240),this.buf=new ArrayBuffer(this.imageData.data.length),this.buf8=new Uint8ClampedArray(this.buf),this.buf32=new Uint32Array(this.buf);for(var e=0;e<this.buf32.length;++e)this.buf32[e]=4278190080}},{key:"screenshot",value:function(){var e=new Image;return e.src=this.canvas.toDataURL("image/png"),e}}]),n}(o.Component)),m=n(12),v=n.n(m),p=function(e){},O=function(){function e(t){var n=this,o=t.onBufferUnderrun;Object(u.a)(this,e),this.onaudioprocess=function(e){var t=e.outputBuffer.getChannelData(0),o=e.outputBuffer.getChannelData(1),a=t.length;n.buffer.size()<2*a&&n.onBufferUnderrun&&n.onBufferUnderrun(n.buffer.size(),2*a);try{var r=n.buffer.deqN(2*a)}catch(e){var i=n.buffer.size()/2;i>0&&console.log("Buffer underrun (needed ".concat(a,", got ").concat(i,")"));for(var s=0;s<a;s++)t[s]=0,o[s]=0;return}for(var u=0;u<a;u++)t[u]=r[2*u],o[u]=r[2*u+1]},this.onBufferUnderrun=o,this.bufferSize=8192,this.buffer=new v.a(2*this.bufferSize)}return Object(c.a)(e,[{key:"getSampleRate",value:function(){return this.audioCtx?this.audioCtx.sampleRate:44100}},{key:"start",value:function(){window.AudioContext||window.webkitAudioContext?(this.audioCtx=window.audioContext,this.scriptNode=this.audioCtx.createScriptProcessor(1024,0,2),this.scriptNode.onaudioprocess=this.onaudioprocess,this.scriptNode.connect(this.audioCtx.destination)):console.log("audio context not support")}},{key:"stop",value:function(){this.scriptNode&&(this.scriptNode.disconnect(this.audioCtx.destination),this.scriptNode.onaudioprocess=null,this.scriptNode=null),this.audioCtx&&(this.audioCtx.close().catch(p),this.audioCtx=null)}},{key:"writeSample",value:function(e,t){this.buffer.size()/2>=this.bufferSize&&this.buffer.deqN(this.bufferSize/2),this.buffer.enq(e),this.buffer.enq(t)}}]),e}(),y=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(u.a)(this,n);for(var o=arguments.length,a=new Array(o),r=0;r<o;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).start=function(){e.frameTimer.start(),e.speakers.start()},e.stop=function(){e.frameTimer.stop(),e.speakers.stop(),clearInterval(e.fpsInterval)},e}return Object(c.a)(n,[{key:"render",value:function(){var e=this;return a.a.createElement(f,{ref:function(t){e.screen=t},onGenerateFrame:function(){e.nes.frame()},onMouseDown:function(t,n){e.nes.zapperMove(t,n),e.nes.zapperFireDown()},onMouseUp:function(){e.nes.zapperFireUp()}})}},{key:"onKeydown",value:function(e){this.nes.buttonDown(1,e)}},{key:"onKeyup",value:function(e){this.nes.buttonUp(1,e)}},{key:"componentDidMount",value:function(){var e=this;this.fitInParent(),this.speakers=new O({onBufferUnderrun:function(t,n){e.props.paused||(e.frameTimer.generateFrame(),e.speakers.buffer.size()<n&&e.frameTimer.generateFrame())}}),this.nes=new d.NES({onFrame:this.screen.setBuffer,onStatusUpdate:console.log,onAudioSample:this.speakers.writeSample.bind(this.speakers),sampleRate:this.speakers.getSampleRate()}),window.nes=this.nes,this.frameTimer=new T({onGenerateFrame:this.nes.frame,onWriteFrame:this.screen.writeBuffer}),this.nes.loadROM(this.props.romData),this.start()}},{key:"componentWillUnmount",value:function(){this.stop(),document.removeEventListener("keydown",this.keyboardController.handleKeyDown),document.removeEventListener("keyup",this.keyboardController.handleKeyUp),document.removeEventListener("keypress",this.keyboardController.handleKeyPress),this.gamepadPolling.stop(),window.nes=void 0}},{key:"componentDidUpdate",value:function(e){this.props.paused!==e.paused&&(this.props.paused?this.stop():this.start())}},{key:"fitInParent",value:function(){this.screen.fitInParent()}}]),n}(o.Component),E=[{name:"\u70ed\u8840\u8054\u76df\u8db3\u7403\uff08\u6c49\u5316\u7248\uff09",url:"./roms/nekketsu_zuqiu3_CHS.nes"},{name:"\u70ed\u8840\u7bee\u7403\uff08\u6c49\u5316\u7248\uff09",url:"./roms/rexuelanqiu.nes"},{name:"\u70ed\u8840\u683c\u6597\u4f20\u8bf4",url:"./roms/rexuegedou.nes"},{name:"\u53e4\u5df4\u6218\u4e89",url:"./roms/GUERRILLA_WAR.nes"},{name:"\u9b42\u6597\u7f57",url:"./roms/hundouluo.nes"}];var w,N;n(26);function B(e){var t=[];switch(e){case N.TOP:t=[w.BUTTON_UP];break;case N.LEFT:t=[w.BUTTON_LEFT];break;case N.BOTTOM:t=[w.BUTTON_DOWN];break;case N.RIGHT:t=[w.BUTTON_RIGHT];break;case N.LEFT_TOP:t=[w.BUTTON_LEFT,w.BUTTON_UP];break;case N.LEFT_BOTTOM:t=[w.BUTTON_LEFT,w.BUTTON_DOWN];break;case N.RIGHT_TOP:t=[w.BUTTON_RIGHT,w.BUTTON_UP];break;case N.RIGHT_BOTTOM:t=[w.BUTTON_DOWN,w.BUTTON_RIGHT]}return t}!function(e){e[e.BUTTON_A=0]="BUTTON_A",e[e.BUTTON_B=1]="BUTTON_B",e[e.BUTTON_SELECT=2]="BUTTON_SELECT",e[e.BUTTON_START=3]="BUTTON_START",e[e.BUTTON_UP=4]="BUTTON_UP",e[e.BUTTON_DOWN=5]="BUTTON_DOWN",e[e.BUTTON_LEFT=6]="BUTTON_LEFT",e[e.BUTTON_RIGHT=7]="BUTTON_RIGHT"}(w||(w={})),function(e){e[e.NONE=0]="NONE",e[e.LEFT=2]="LEFT",e[e.TOP=4]="TOP",e[e.RIGHT=8]="RIGHT",e[e.BOTTOM=16]="BOTTOM",e[e.LEFT_TOP=32]="LEFT_TOP",e[e.RIGHT_TOP=64]="RIGHT_TOP",e[e.RIGHT_BOTTOM=128]="RIGHT_BOTTOM",e[e.LEFT_BOTTOM=256]="LEFT_BOTTOM"}(N||(N={}));var b=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var o;return Object(u.a)(this,n),(o=t.call(this,e)).stick=void 0,o.state={currentstatus:0},o.stick=a.a.createRef(),o}return Object(c.a)(n,[{key:"handleTouchStart",value:function(e){if(this.stick){var t=e.targetTouches[0],n=this.stick.current.getBoundingClientRect();this.dispatchTouchEvent(n,{x:t.pageX,y:t.pageY}),e.preventDefault()}}},{key:"handleTouchMove",value:function(e){if(this.stick.current){var t=e.targetTouches[0],n=this.stick.current.getBoundingClientRect();this.dispatchTouchEvent(n,{x:t.pageX,y:t.pageY}),e.preventDefault()}}},{key:"handleTouchEnd",value:function(e){var t=this;B(this.state.currentStatus).forEach((function(e){return t.props.onkeyUp(e)})),this.setState({currentStatus:N.NONE}),e.preventDefault()}},{key:"dispatchTouchEvent",value:function(e,t){var n=(e.left+e.right)/2,o=(e.top+e.bottom)/2,a=N.NONE;t.x<n-22?t.y<o-22?a=N.LEFT_TOP:t.y>=o-22&&t.y<o+22?a=N.LEFT:t.y>=o+22&&(a=N.LEFT_BOTTOM):t.x>=n-22&&t.x<n+22?t.y<o-22?a=N.TOP:t.y>=o-22&&t.y<o+22||t.y>=o+22&&(a=N.BOTTOM):t.x>=n+22&&(t.y<o-22?a=N.RIGHT_TOP:t.y>=o-22&&t.y<o+22?a=N.RIGHT:t.y>=o+22&&(a=N.RIGHT_BOTTOM)),this.state.currentStatus!==a&&this.changeControllerDirection(a)}},{key:"changeControllerDirection",value:function(e){var t=this,n=B(this.state.currentStatus),o=B(e);n.forEach((function(e){o.indexOf(e)<0&&t.props.onkeyUp(e)})),o.forEach((function(e){n.indexOf(e)<0&&t.props.onKeyDown(e)})),this.setState({currentStatus:e})}},{key:"componentDidMount",value:function(){var e=document.getElementById("arrow-controls");null===e||void 0===e||e.addEventListener("touchstart",this.handleTouchStart.bind(this),!1),null===e||void 0===e||e.addEventListener("touchmove",this.handleTouchMove.bind(this),!1),null===e||void 0===e||e.addEventListener("touchend",this.handleTouchEnd.bind(this),!1)}},{key:"componentWillUnmount",value:function(){var e=document.getElementById("arrow-controls");null===e||void 0===e||e.removeEventListener("touchstart",this.handleTouchStart,!1),null===e||void 0===e||e.removeEventListener("touchmove",this.handleTouchMove,!1),null===e||void 0===e||e.removeEventListener("touchend",this.handleTouchEnd,!1)}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{id:"left-controller"},a.a.createElement("div",{className:"option-controls"},a.a.createElement("div",{id:"control-select",className:"gamepad",onClick:function(t){e.props.onKeyDown(w.BUTTON_SELECT),setTimeout((function(){e.props.onkeyUp(w.BUTTON_SELECT)}),50),t.preventDefault()}})),a.a.createElement("div",{className:"arrow-controls",id:"arrow-controls",ref:this.stick},a.a.createElement("div",{className:"arrow-top"},a.a.createElement("div",{id:"control-top",className:"gamepad"})),a.a.createElement("div",{className:"arrow-left-right"},a.a.createElement("div",{id:"control-left",className:"gamepad"}),a.a.createElement("div",{id:"control-right",className:"gamepad"})),a.a.createElement("div",{className:"arrow-down"},a.a.createElement("div",{id:"control-down",className:"gamepad"}))),a.a.createElement("div",{className:"option-controls"}))}}]),n}(a.a.Component),g=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var o;return Object(u.a)(this,n),(o=t.call(this,e)).buttonA=void 0,o.buttonB=void 0,o.buttonC=void 0,o.buttonA=a.a.createRef(),o.buttonB=a.a.createRef(),o.buttonC=a.a.createRef(),o.state={currentStatus:0},o}return Object(c.a)(n,[{key:"handleTouchStart",value:function(e){var t=e.targetTouches[0];this.dispatchTouchEvent({x:t.pageX,y:t.pageY}),e.preventDefault()}},{key:"handleTouchMove",value:function(e){var t=e.targetTouches[0];this.dispatchTouchEvent({x:t.pageX,y:t.pageY}),e.preventDefault()}},{key:"handleTouchEnd",value:function(e){var t=this;this.state.currentStatus>0&&(this.keysForStatus(this.state.currentStatus).forEach((function(e){return t.props.onkeyUp(e)})),this.setState({currentStatus:0}));e.preventDefault()}},{key:"rectContainsPoint",value:function(e,t){return t.x>=e.left&&t.x<=e.right&&t.y>=e.top&&t.y<=e.bottom}},{key:"dispatchTouchEvent",value:function(e){var t=this;if(this.buttonA.current&&this.buttonB.current&&this.buttonC.current){var n=this.buttonA.current.getBoundingClientRect(),o=this.buttonB.current.getBoundingClientRect(),a=this.buttonC.current.getBoundingClientRect(),r=0;if(this.rectContainsPoint(n,e)?r=1:this.rectContainsPoint(o,e)?r=2:this.rectContainsPoint(a,e)&&(r=3),r!==this.state.currentStatus)this.keysForStatus(r).forEach((function(e){return t.props.onKeyDown(e)})),this.setState({currentStatus:r})}}},{key:"keysForStatus",value:function(e){switch(e){case 1:return[w.BUTTON_A];case 2:return[w.BUTTON_B];case 3:return[w.BUTTON_A,w.BUTTON_B]}return[]}},{key:"componentDidMount",value:function(){var e=document.getElementById("action-controls");null===e||void 0===e||e.addEventListener("touchstart",this.handleTouchStart.bind(this),!1),null===e||void 0===e||e.addEventListener("touchmove",this.handleTouchMove.bind(this),!1),null===e||void 0===e||e.addEventListener("touchend",this.handleTouchEnd.bind(this),!1)}},{key:"componentWillUnmount",value:function(){var e=document.getElementById("action-controls");null===e||void 0===e||e.removeEventListener("touchstart",this.handleTouchStart,!1),null===e||void 0===e||e.removeEventListener("touchmove",this.handleTouchMove,!1),null===e||void 0===e||e.removeEventListener("touchend",this.handleTouchEnd,!1)}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{id:"right-controller"},a.a.createElement("div",{className:"option-controls",style:{justifyContent:"flex-start"}},a.a.createElement("div",{id:"control-start",className:"gamepad",onClick:function(t){e.props.onKeyDown(w.BUTTON_START),setTimeout((function(){e.props.onkeyUp(w.BUTTON_START)}),50),t.preventDefault()}})),a.a.createElement("div",{className:"arrow-controls",id:"action-controls",style:{justifyContent:"space-around"}},a.a.createElement("div",{className:"arrow-top"},a.a.createElement("div",{id:"control-ab",className:"gamepad",ref:this.buttonC})),a.a.createElement("div",{className:"arrow-top",style:{justifyContent:"space-around"}},a.a.createElement("div",{id:"control-b",className:"gamepad",ref:this.buttonB}),a.a.createElement("div",{id:"control-a",className:"gamepad",ref:this.buttonA}))),a.a.createElement("div",{className:"option-controls"}))}}]),n}(a.a.Component),k=[75,74,84,89,87,83,65,68];function U(e){return a.a.createElement("div",{className:"game-list",onClick:function(t){var n=t.target.getAttribute("data-key");if(n&&(e.onselect(n),!window.audioContext)){var o=window.AudioContext||window.webkitAudioContext;window.audioContext=new o,window.audioContext.resume()}}},E.map((function(e){return a.a.createElement("div",{className:"game",key:e.url,"data-key":e.url},e.name)})))}var C=function(){var e=Object(o.useState)(null),t=Object(s.a)(e,2),n=t[0],r=t[1],i=Object(o.useState)(""),u=Object(s.a)(i,2),c=u[0],l=u[1],h=Object(o.useRef)(null);Object(o.useEffect)((function(){0!==c.length&&function(e,t,n){var o=new XMLHttpRequest;o.open("GET",e),o.overrideMimeType("text/plain; charset=x-user-defined"),o.onload=function(){if(200===this.status){if(o.responseText.match(/^<!doctype html>/i))return t(new Error("Page not found"));t(null,this.responseText)}else 0===this.status||t(new Error(o.statusText))},o.onerror=function(){t(new Error(o.statusText))},o.onprogress=function(e){n(e.loaded/e.total)},o.send()}(c,(function(e,t){t&&r(t)}),(function(e){console.log(e)}))}),[c]);var d=function(e){console.log("keydown",e),window.nes&&window.nes.buttonDown(1,e)},T=function(e){console.log("keyup",e),window.nes&&window.nes.buttonUp(1,e)};return a.a.createElement("div",{className:"App"},a.a.createElement(b,{onKeyDown:function(e){return d(e)},onkeyUp:function(e){return T(e)}}),a.a.createElement("div",{id:"monitor"},n?a.a.createElement(y,{romData:n,ref:h}):a.a.createElement(U,{onselect:function(e){return l(e)}})),a.a.createElement("div",{id:"right-controller"},a.a.createElement(g,{onKeyDown:function(e){return d(e)},onkeyUp:function(e){return T(e)}})))};i.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(C,null)),document.getElementById("root")),window.onkeydown=function(e){var t=k.indexOf(e.keyCode);t<0||window.nes&&window.nes.buttonDown(1,t)},window.onkeyup=function(e){var t=k.indexOf(e.keyCode);t<0||window.nes&&window.nes.buttonUp(1,t)}}},[[13,1,2]]]);
//# sourceMappingURL=main.7dc1aa16.chunk.js.map